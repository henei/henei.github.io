<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>多页路由与模板解析 | Chen&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/profile.png">
    <meta name="description" content="我的个人网站">
    
    <link rel="preload" href="/assets/css/0.styles.23b7c006.css" as="style"><link rel="preload" href="/assets/js/app.94d98655.js" as="script"><link rel="preload" href="/assets/js/2.981d4174.js" as="script"><link rel="preload" href="/assets/js/14.da55ecb1.js" as="script"><link rel="prefetch" href="/assets/js/10.241d0ae0.js"><link rel="prefetch" href="/assets/js/11.d457cd72.js"><link rel="prefetch" href="/assets/js/12.a71ebe50.js"><link rel="prefetch" href="/assets/js/13.21b061f7.js"><link rel="prefetch" href="/assets/js/15.8454ba16.js"><link rel="prefetch" href="/assets/js/16.4b22ccb7.js"><link rel="prefetch" href="/assets/js/17.7eed99bd.js"><link rel="prefetch" href="/assets/js/18.48906ae2.js"><link rel="prefetch" href="/assets/js/19.7e6a7102.js"><link rel="prefetch" href="/assets/js/20.b9e7face.js"><link rel="prefetch" href="/assets/js/21.1c8fee8d.js"><link rel="prefetch" href="/assets/js/22.29304177.js"><link rel="prefetch" href="/assets/js/23.8c1cedef.js"><link rel="prefetch" href="/assets/js/24.43a407f4.js"><link rel="prefetch" href="/assets/js/3.6d8e98ba.js"><link rel="prefetch" href="/assets/js/4.a40f774e.js"><link rel="prefetch" href="/assets/js/5.b7462bd8.js"><link rel="prefetch" href="/assets/js/6.0377ba0c.js"><link rel="prefetch" href="/assets/js/7.dc078c9b.js"><link rel="prefetch" href="/assets/js/8.c1b4ebd3.js"><link rel="prefetch" href="/assets/js/9.cce11f93.js">
    <link rel="stylesheet" href="/assets/css/0.styles.23b7c006.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/profile.png" alt="Chen's blog" class="logo"> <span class="site-name can-hide">Chen's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/vuebase/" class="nav-link router-link-active">
  Vue基础
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="链接" class="dropdown-title"><span class="title">链接</span> <span class="arrow down"></span></button> <button type="button" aria-label="链接" class="mobile-dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/vuebase/" class="nav-link router-link-active">
  Vue基础
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="链接" class="dropdown-title"><span class="title">链接</span> <span class="arrow down"></span></button> <button type="button" aria-label="链接" class="mobile-dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vuebase/" aria-current="page" class="sidebar-link">Vue CLI 3 项目构建基础</a></li><li><a href="/vuebase/build1.html" class="sidebar-link">包管理工具与配置项</a></li><li><a href="/vuebase/build2.html" class="sidebar-link">webpack 在 CLI 3 中的应用</a></li><li><a href="/vuebase/build3.html" class="sidebar-link">env 文件与环境设置</a></li><li><a href="/vuebase/combat1.html" class="sidebar-link">单页应用的基本配置</a></li><li><a href="/vuebase/combat2.html" class="sidebar-link">使用 pages 构建多页应用</a></li><li><a href="/vuebase/combat3.html" aria-current="page" class="active sidebar-link">多页路由与模板解析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebase/combat3.html#路由配置" class="sidebar-link">路由配置</a></li><li class="sidebar-sub-header"><a href="/vuebase/combat3.html#模板配置" class="sidebar-link">模板配置</a></li><li class="sidebar-sub-header"><a href="/vuebase/combat3.html#结语" class="sidebar-link">结语</a></li><li class="sidebar-sub-header"><a href="/vuebase/combat3.html#思考-作业" class="sidebar-link">思考 &amp; 作业</a></li></ul></li><li><a href="/vuebase/combat4.html" class="sidebar-link">项目整合与优化</a></li><li><a href="/vuebase/expand1.html" class="sidebar-link">扩充你的开发工具</a></li><li><a href="/vuebase/expand2.html" class="sidebar-link">将 UI 界面交给第三方库</a></li><li><a href="/vuebase/expand3.html" class="sidebar-link">尝试使用外部数据</a></li><li><a href="/vuebase/guide1.html" class="sidebar-link">从编码技巧与规范开始</a></li><li><a href="/vuebase/guide2.html" class="sidebar-link">编写可复用性模块</a></li><li><a href="/vuebase/guide3.html" class="sidebar-link">合理划分容器组件与展示组件</a></li><li><a href="/vuebase/guide4.html" class="sidebar-link">数据驱动与拼图游戏</a></li><li><a href="/vuebase/guide5.html" class="sidebar-link">Vue API 盲点解析</a></li><li><a href="/vuebase/summary.html" class="sidebar-link">总结</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="多页路由与模板解析"><a href="#多页路由与模板解析" class="header-anchor">#</a> 多页路由与模板解析</h1> <p>上篇文章中我们成功打包并输出了多页文件，而构建一个多页应用能够让我们进一步了解项目配置的可拓展性，可以对学习 Vue 和 webpack 起到强化训练的效果，本文将在此基础上主要针对多页路由及模板的配置进行系列的介绍。</p> <h2 id="路由配置"><a href="#路由配置" class="header-anchor">#</a> 路由配置</h2> <h3 id="_1-跳转"><a href="#_1-跳转" class="header-anchor">#</a> 1. 跳转</h3> <p>在配置路由前，首先我们要明确一点就是，多页应用中的每个单页都是相互隔离的，即如果你想从 page1 下的路由跳到 page2 下的路由，你无法使用 vue-router 中的方法进行跳转，需要使用原生方法：<code>location.href</code> 或 <code>location.replace</code>。</p> <p>此外为了能够清晰的分辨路由属于哪个单页，我们应该给每个单页路由添加前缀，比如：</p> <ul><li>index 单页：/vue/</li> <li>page1 单页：/vue/page1/</li> <li>page2 单页：/vue/page2/</li></ul> <p>其中 /vue/ 为项目的二级目录，其后的目录代表路由属于哪个单页。因此我们每个单页的路由配置可以像这样：</p> <div class="language- extra-class"><pre class="language-text"><code>/* page1 单页路由配置 */

import Vue from 'vue'
import Router from 'vue-router'

// 首页
const Home = (resolve =&gt; {
    require.ensure(['../views/home.vue'], () =&gt; {
        resolve(require('../views/home.vue'))
    })
})

Vue.use(Router)

let base = `${process.env.BASE_URL}` + 'page1'; // 添加单页前缀

export default new Router({
    mode: 'history',
    base: base,
    routes: [
        {
            path: '/',
            name: 'home',
            component: Home
        },
    ]
})

</code></pre></div><p>我们通过设置路由的 base 值来为每个单页添加路由前缀，如果是 index 单页我们无需拼接路由前缀，直接跳转至二级目录即可。</p> <p>那么在单页间跳转的地方，我们可以这样写：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;template&gt;
  &lt;div id=&quot;app&quot;&gt;
    &lt;div id=&quot;nav&quot;&gt;
      &lt;a @click=&quot;goFn('')&quot;&gt;Index&lt;/a&gt; |
      &lt;a @click=&quot;goFn('page1')&quot;&gt;Page1&lt;/a&gt; |
      &lt;a @click=&quot;goFn('page2')&quot;&gt;Page2&lt;/a&gt; |
    &lt;/div&gt;
    &lt;router-view/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    methods: {
        goFn(name) {
            location.href = `${process.env.BASE_URL}` + name
        }
    }
}
&lt;/script&gt;

</code></pre></div><p>但是为了保持和 Vue 路由跳转同样的风格，我可以对单页之间的跳转做一下封装，实现一个 <code>Navigator</code> 类，类的代码可以查看本文最后的示例，封装完成后我们可以将跳转方法修改为：</p> <div class="language- extra-class"><pre class="language-text"><code>this.$openRouter({
    name: name, // 跳转地址
    query: {
        text: 'hello' // 可以进行参数传递
    },
})

</code></pre></div><p>使用上述 <code>$openRouter</code> 方法我们还需要一个前提条件，便是将其绑定到 Vue 的原型链上，我们在所有单页的入口文件中添加：</p> <div class="language- extra-class"><pre class="language-text"><code>import { Navigator } from '../../common' // 引入 Navigator

Vue.prototype.$openRouter = Navigator.openRouter; // 添加至 Vue 原型链

</code></pre></div><p>至此我们已经能够成功模仿 vue-router 进行单页间的跳转，但是需要注意的是因为其本质使用的是 location 跳转，所以必然会产生浏览器的刷新与重载。</p> <h3 id="_2-重定向"><a href="#_2-重定向" class="header-anchor">#</a> 2. 重定向</h3> <p>当我们完成上述路由跳转的功能后，可以在本地服务器上来进行一下测试，你会发现 Index 首页可以正常打开，但是跳转 Page1、Page2 却仍然处于 Index 父组件下，这是因为浏览器认为你所要跳转的页面还是在 Index 根路由下，同时又没有匹配到 Index 单页中对应的路由。这时候我们服务器需要做一次重定向，将下方路由指向对应的 html 文件即可：</p> <div class="language- extra-class"><pre class="language-text"><code>/vue/page1 -&gt; /vue/page1.html
/vue/page2 -&gt; /vue/page2.html

</code></pre></div><p>在 vue.config.js 中，我们需要对 devServer 进行配置，添加 <code>historyApiFallback</code> 配置项，该配置项主要用于解决 HTML5 History API 产生的问题，比如其 rewrites 选项用于重写路由：</p> <div class="language- extra-class"><pre class="language-text"><code>/* vue.config.js */

let baseUrl = '/vue/';

module.exports = {
    ...
    
    devServer: {
        historyApiFallback: {
            rewrites: [
                { from: new RegExp(baseUrl + 'page1'), to: baseUrl + 'page1.html' },
                { from: new RegExp(baseUrl + 'page2'), to: baseUrl + 'page2.html' },
            ]
        }
    }
    
    ...
}

</code></pre></div><p>上方我们通过 rewrites 匹配正则表达式的方式将 <code>/vue/page1</code> 这样的路由替换为访问服务器下正确 html 文件的形式，如此不同单页间便可以进行正确跳转和访问了。最后需要注意的是如果你的应用发布到正式服务器上，你同样需要让服务器或者中间层作出合理解析，参考：<a href="https://router.vuejs.org/zh/guide/essentials/history-mode.html#%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE%E4%BE%8B%E5%AD%90" target="_blank" rel="noopener noreferrer">HTML5 History 模式 # 后端配置例子<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>而更多关于 historyApiFallback 的信息可以访问：<a href="https://github.com/bripkens/connect-history-api-fallback" target="_blank" rel="noopener noreferrer">connect-history-api-fallback<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="模板配置"><a href="#模板配置" class="header-anchor">#</a> 模板配置</h2> <p>上篇文章我们已经介绍了关于多模板的读取和配置，在配置 html-webpack-plugin 的时候我们提到了自定义配置，这里我将结合模板渲染的功能来进行统一介绍。</p> <h3 id="_1-模板渲染"><a href="#_1-模板渲染" class="header-anchor">#</a> 1. 模板渲染</h3> <p>这里所说的模板渲染是在我们的 html 模板文件中使用 html-webpack-plugin 提供的 <a href="https://github.com/jaketrent/html-webpack-template/blob/86f285d5c790a6c15263f5cc50fd666d51f974fd/index.html" target="_blank" rel="noopener noreferrer">default template<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 语法进行模板编写，比如：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1.0&quot;&gt;
    &lt;title&gt;模板&lt;/title&gt;
    &lt;% for (var chunk in htmlWebpackPlugin.files.css) { %&gt;
        &lt;% if(htmlWebpackPlugin.files.css[chunk]) {%&gt;
            &lt;link href=&quot;&lt;%= htmlWebpackPlugin.files.css[chunk] %&gt;&quot; rel=&quot;stylesheet&quot; /&gt;
        &lt;%}%&gt;
    &lt;% } %&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;
    &lt;!-- built files will be auto injected --&gt;

    &lt;% for (var chunk in htmlWebpackPlugin.files.js) { %&gt;
        &lt;% if(htmlWebpackPlugin.files.js[chunk]) {%&gt;
            &lt;script type=&quot;text/javascript&quot; src=&quot;&lt;%= htmlWebpackPlugin.files.js[chunk] %&gt;&quot;&gt;&lt;/script&gt;
        &lt;%}%&gt;
    &lt;% } %&gt;
  &lt;/body&gt;
&lt;/html&gt;

</code></pre></div><p>以上我们使用模板语法手动获取并遍历 htmlWebpackPlugin 打包后的文件并生成到模板中，其中的 <code>htmlWebpackPlugin</code> 变量是模板提供的可访问变量，其有以下特定数据：</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;htmlWebpackPlugin&quot;: {
    &quot;files&quot;: {
        &quot;css&quot;: [ &quot;main.css&quot; ],
        &quot;js&quot;: [ &quot;assets/head_bundle.js&quot;, &quot;assets/main_bundle.js&quot;],
        &quot;chunks&quot;: {
            &quot;head&quot;: {
                &quot;entry&quot;: &quot;assets/head_bundle.js&quot;,
                &quot;css&quot;: [ &quot;main.css&quot; ]
            },
            &quot;main&quot;: {
                &quot;entry&quot;: &quot;assets/main_bundle.js&quot;,
                &quot;css&quot;: []
            },
        }
    }
}

</code></pre></div><p>我们通过 <code>htmlWebpackPlugin.files</code> 可以获取打包输出的 js 及 css 文件路径，包括入口文件路径等。</p> <p>需要注意的是如果你在模板中编写了插入对应 js 及 css 的语法，你需要设置 <code>inject</code> 的值为 false 来关闭资源的自动注入：</p> <div class="language- extra-class"><pre class="language-text"><code>/* utils.js */
...

let conf = {
    entry: filePath, // page 的入口
    template: filePath, // 模板路径
    filename: filename + '.html', // 生成 html 的文件名
    chunks: ['manifest', 'vendor',  filename],
    inject: false, // 关闭资源自动注入
}

...

</code></pre></div><p>否则在页面会引入两次资源，如下图所示：</p> <p><img src="https://user-gold-cdn.xitu.io/2018/8/3/164fb7b172500b55?w=560&amp;h=512&amp;f=png&amp;s=135647" alt=""></p> <h3 id="_2-自定义配置"><a href="#_2-自定义配置" class="header-anchor">#</a> 2. 自定义配置</h3> <p>在模板渲染中，我们只能够使用 htmlWebpackPlugin 内部的一些属性和方法来进行模板的定制化开发，那么如果遇到需要根据不同环境来引入不同资源，同时不同模板间的配置还可能不一样的需求情况的话，我们使用自定义配置会比较方便。比如我们需要在生产环境模板中引入第三方统计脚本：</p> <div class="language- extra-class"><pre class="language-text"><code>/* vue.config.js */

module.exports = {
    ...
    
    pages: utils.setPages({
        addScript() {
            if (process.env.NODE_ENV === 'production') {
                return `
                    &lt;script src=&quot;https://s95.cnzz.com/z_stat.php?id=xxx&amp;web_id=xxx&quot; language=&quot;JavaScript&quot;&gt;&lt;/script&gt;
                `
            }

            return ''
        }
    }),
    
    ...
}

</code></pre></div><p>然后在页面模板中通过 <code>htmlWebpackPlugin.options</code> 获取自定义配置对象并进行输出：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;% if(htmlWebpackPlugin.options.addScript){ %&gt;
    &lt;%= htmlWebpackPlugin.options.addScript() %&gt;
&lt;%}%&gt;

</code></pre></div><p>同时你也可以针对个别模板进行配置，比如我想只在 Index 单页中添加统计脚本，在 Page1 单页中添加其他脚本，那么你可以给 addScript 传入标识符来进行判断输出，比如：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;% if(htmlWebpackPlugin.options.addScript){ %&gt;
    &lt;%= htmlWebpackPlugin.options.addScript('index') %&gt;
&lt;%}%&gt;

</code></pre></div><p>同时为 addScript 方法添加参数 from：</p> <div class="language- extra-class"><pre class="language-text"><code>addScript(from) {
    if (process.env.NODE_ENV === 'production') {
        let url = &quot;https://xxx&quot;;
    
        if (from === 'index') {
            url = &quot;https://s95.cnzz.com/z_stat.php?id=xxx&amp;web_id=xxx&quot;;
        }
        
        return `
            &lt;script src=${url} language=&quot;JavaScript&quot;&gt;&lt;/script&gt;
        `
    }

    return ''
}

</code></pre></div><p>这样我们就完成了自定义配置中的模板渲染功能。当然根据实际项目需求你的自定义配置项可能会更加复杂和灵活。</p> <h2 id="结语"><a href="#结语" class="header-anchor">#</a> 结语</h2> <p>通过 2 小节的学习，相信大家对 Vue 多页应用的构建已经有所了解。本文在第 1 节的基础上重点介绍了多页路由及模板的配置，阐述了其与单页应用的不同之处，同时针对模板自定义配置的使用场景给出了简单的实例，希望大家在了解的基础上将下方的实例代码作为参考，进行相应的实战。</p> <p>本案例代码地址：<a href="https://github.com/luozhihao/vue-project-code/tree/master/multi-page-project" target="_blank" rel="noopener noreferrer">multi-page-project<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="思考-作业"><a href="#思考-作业" class="header-anchor">#</a> 思考 &amp; 作业</h2> <ul><li><p>多页应用中各自的 <code>Vuex Store</code> 信息能实现共享吗？</p></li> <li><p>html-webpack-plugin 如何解析非 .html 的模板，比如 .hbs，应该如何配置？</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuebase/combat2.html" class="prev">
        使用 pages 构建多页应用
      </a></span> <span class="next"><a href="/vuebase/combat4.html">
        项目整合与优化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.94d98655.js" defer></script><script src="/assets/js/2.981d4174.js" defer></script><script src="/assets/js/14.da55ecb1.js" defer></script>
  </body>
</html>
