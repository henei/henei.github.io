(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7498e472","chunk-7e348036"],{"0bd6":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{ref:"flowDetail",staticStyle:{height:"100%"}}),t._v(" "),s("el-drawer",{staticStyle:{"overflow-y":"auto"},attrs:{title:"任务详情",visible:t.drawer,modal:!1,"append-to-body":!0},on:{"update:visible":function(e){t.drawer=e},close:t.closeDrawer}},[s("el-scrollbar",{staticStyle:{height:"100%"}},[s("el-form",{staticStyle:{width:"500px"},attrs:{model:t.taskForm,"label-width":"120px"}},[s("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[s("el-input",{staticStyle:{width:"200px"},attrs:{disabled:""},model:{value:t.taskForm.name,callback:function(e){t.$set(t.taskForm,"name",e)},expression:"taskForm.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"类型",prop:"type"}},[s("el-select",{attrs:{placeholder:"请选择任务类型",disabled:""},model:{value:t.taskForm.type,callback:function(e){t.$set(t.taskForm,"type",e)},expression:"taskForm.type"}},[s("el-option",{attrs:{label:"batch",value:"0"}}),t._v(" "),s("el-option",{attrs:{label:"stream",value:"1"}})],1)],1),t._v(" "),s("el-form-item",{attrs:{label:"cron表达式",prop:"cronExpression"}},[s("el-input",{staticStyle:{width:"200px"},attrs:{disabled:""},model:{value:t.taskForm.cronExpression,callback:function(e){t.$set(t.taskForm,"cronExpression",e)},expression:"taskForm.cronExpression"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"最长运行时间",prop:"maxRunTime"}},[s("el-input",{staticStyle:{width:"200px"},attrs:{disabled:""},model:{value:t.taskForm.maxRunTime,callback:function(e){t.$set(t.taskForm,"maxRunTime",e)},expression:"taskForm.maxRunTime"}}),t._v(" "),s("label",[t._v("(分钟)")])],1),t._v(" "),s("el-form-item",{attrs:{label:"并发数",prop:"concurrency"}},[s("el-input-number",{attrs:{"controls-position":"right",min:0,disabled:""},model:{value:t.taskForm.concurrency,callback:function(e){t.$set(t.taskForm,"concurrency",e)},expression:"taskForm.concurrency"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"频率",prop:"period"}},[s("el-select",{attrs:{disabled:""},model:{value:t.taskForm.period,callback:function(e){t.$set(t.taskForm,"period",e)},expression:"taskForm.period"}},[s("el-option",{attrs:{label:"单次",value:"0"}}),t._v(" "),s("el-option",{attrs:{label:"重复",value:"1"}})],1)],1),t._v(" "),s("el-form-item",{attrs:{label:"重试次数",prop:"retry"}},[s("el-input-number",{attrs:{"controls-position":"right",min:0,disabled:""},model:{value:t.taskForm.retry,callback:function(e){t.$set(t.taskForm,"retry",e)},expression:"taskForm.retry"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"开始时间",prop:"startTime"}},[s("el-input",{staticStyle:{width:"200px"},attrs:{disabled:""},model:{value:t.taskForm.startTime,callback:function(e){t.$set(t.taskForm,"startTime",e)},expression:"taskForm.startTime"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"描述",prop:"description"}},[s("el-input",{staticStyle:{width:"200px"},attrs:{type:"textarea",rows:4,disabled:""},model:{value:t.taskForm.description,callback:function(e){t.$set(t.taskForm,"description",e)},expression:"taskForm.description"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"数据源"}},[s("div",{staticClass:"select-table_border",staticStyle:{width:"80%"}},[s("el-row",{staticStyle:{"margin-bottom":"20px"}},[s("el-col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{span:8}},[s("span",[t._v("数据来源")])]),t._v(" "),s("el-col",{attrs:{span:16}},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.source,placement:"top"}},[s("el-input",{staticStyle:{width:"80%"},attrs:{disabled:""},model:{value:t.source,callback:function(e){t.source=e},expression:"source"}})],1)],1)],1),t._v(" "),t.isShowSink?s("el-row",[s("el-col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{span:8}},[s("span",[t._v("数据去向")])]),t._v(" "),s("el-col",{attrs:{span:16}},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.sink,placement:"top"}},[s("el-input",{staticStyle:{width:"80%"},attrs:{disabled:""},model:{value:t.sink,callback:function(e){t.sink=e},expression:"sink"}})],1)],1)],1):t._e()],1)])],1)],1)],1)],1)},l=[],r=(s("456d"),s("ac6a"),s("7f7f"),s("9b5f")),n=s("6be9"),o={data:function(){return{flowNodes:[],drawer:!1,taskForm:{cronExpression:"",name:"",type:"",description:"",maxRunTime:"",concurrency:0,period:"",retry:0,startTime:""},source:"",sink:"",taskId:"",isShowSink:!0}},methods:{flowGraph:function(){this.$G6.registerNode("sql",{drawShape:function(t,e){var s=e.addShape("rect",{attrs:{x:-35,y:-12,width:70,height:24,radius:2,stroke:"#5B8FF9",fill:"#C6E5FF",lineWidth:1}});return t.name&&e.addShape("text",{attrs:{text:t.name,x:0,y:0,fill:"#00287E",fontSize:14,textAlign:"center",textBaseline:"middle",fontWeight:"bold"}}),s}},"single-shape"),this.$G6.Global.nodeStateStyle.selected={stroke:"#d9d9d9",fill:"#5394ef"};var t=this.$refs.flowDetail.scrollWidth,e=this.$refs.flowDetail.scrollHeight||500,s=new this.$G6.Graph({container:this.$refs.flowDetail,width:t,height:e,layout:{type:"dagre",nodesep:30,ranksep:35},pixelRatio:2,defaultNode:{shape:"sql"},defaultEdge:{style:{offset:20,endArrow:!0,lineWidth:2,stroke:"#C2C8D5"}},modes:{default:["drag-canvas","zoom-canvas","click-select",{type:"tooltip",formatText:function(t){return t.description}}]},fitView:!0});s.data(this.flowNodes),s.render(),s.on("node:click",this.getTaskDetail)},getFlowDetail:function(){var t=this,e=this.$route.query.id;Object(r["showTaskInFlow"])("flowId="+e).then((function(e){if(200===e.code){var s=e.data;if(0===s.length)return void(t.$refs.flowDetail.innerHTML="<div style='margin-top:20%;margin-left:44%;font-size:14px;font-weight:300;font-family:Arial;'>该任务流未添加任务！</div>");var a=[],l=[];s.forEach((function(t,e){var r=t[0].name.length>8?t[0].name.slice(0,7)+"...":t[0].name;a.push({id:t[0].id+"",name:r,description:t[0].name}),e!==s.length-1&&l.push({source:t[0].id+"",target:s[e+1][0].id+""})})),t.flowNodes={nodes:a,edges:l},t.flowGraph()}else t.$message({type:"error",message:e.msg})}),(function(e){t.$message.error(e.response.data.message)}))},getTaskDetail:function(t){var e=this;console.log(t),this.drawer=!0,this.taskId=parseInt(t.item._cfg.id),Object(r["m"])("taskId="+this.taskId).then((function(t){if(200===t.code){var s,a,l,r,n,o;e.taskForm=t.data,"0"===e.taskForm.type&&(e.isShowSink=!1);var i=JSON.parse(t.data.taskXml);if("2"===i.context.source.datasourceType){var c=i.context.source.params;l=i.context.source.name,s=c["db"],a=c["table"],e.source=l+" db:"+s+" table:"+a}else{l=i.context.source.name;var p=i.context.source.params;console.log(p),s=Object.keys(p)[0],a=p[s],e.source=l+" "+s+":"+a}if("0"!==e.taskForm.type)if("2"===i.context.sink.datasourceType){var d=i.context.source.params;r=i.context.sink.name,n=d["db"],o=d["table"],e.sink=r+" db:"+n+" table:"+o}else{r=i.context.sink.name;var u=i.context.sink.params;console.log(u),n=Object.keys(u)[0],o=u[n],e.sink=r+" "+n+":"+o}}}))},closeDrawer:function(){this.isShowSink=!0,this.drawer=!1}},mounted:function(){this.getFlowDetail()},components:{viewDetail:n["default"]}},i=o,c=(s("4a1b"),s("2877")),p=Object(c["a"])(i,a,l,!1,null,null,null);e["default"]=p.exports},"4a1b":function(t,e,s){"use strict";var a=s("7d2d"),l=s.n(a);l.a},"6be9":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-row",[s("el-col",{attrs:{span:8}},[s("label",{staticStyle:{"font-size":"14px"}},[t._v("任务名称：")]),s("span",{staticClass:"dell"},[t._v(t._s(t.taskForm.name))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("label",{staticStyle:{"font-size":"14px"}},[t._v("类型：")]),s("span",{staticClass:"dell"},[t._v(t._s(t._f("taskTypeTransform")(t.taskForm.type)))])])],1),t._v(" "),s("el-collapse",{attrs:{value:["0","1"]}},[s("el-collapse-item",{attrs:{title:"数据配置",name:"0"}},["0"===t.taskForm.type?s("div",[s("el-row",[s("el-col",{attrs:{span:24}},[s("label",{staticStyle:{"font-size":"14px"}},[t._v("shell文件")])])],1),t._v(" "),s("el-row",[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("接口机："+t._s(t.source.name))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("文件路径："+t._s(t.source.params.path))])])],1)],1):t._e(),t._v(" "),"3"===t.taskForm.type?s("div",[s("el-row",[s("el-col",{attrs:{span:24}},[s("label",{staticStyle:{"font-size":"14px"}},[t._v("数据来源(表)")])])],1),t._v(" "),s("el-row",[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("数据源类型："+t._s(t.source.datasourceType))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("集群: "+t._s(t.source.name))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("库: "+t._s(t.source.params.db))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("表: "+t._s(t.source.params.table))])])],1),t._v(" "),s("el-row",[s("el-col",{attrs:{span:24}},[s("label",{staticStyle:{"font-size":"14px"}},[t._v("数据去向(表)")])])],1),t._v(" "),s("el-row",[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("数据源类型："+t._s(t.sink.datasourceType))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("集群: "+t._s(t.sink.name))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("库: "+t._s(t.sink.params.db))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("表: "+t._s(t.sink.params.table))])])],1)],1):t._e(),t._v(" "),"4"===t.taskForm.type?s("div",[s("el-row",[s("el-col",{attrs:{span:24}},[s("label",{staticStyle:{"font-size":"14px"}},[t._v("数据来源(表)")])])],1),t._v(" "),s("el-row",[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("数据源类型："+t._s(t.source.datasourceType))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("集群: "+t._s(t.source.name))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("库: "+t._s(t.source.params.db))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("表: "+t._s(t.source.params.table))])])],1),t._v(" "),s("el-row",[s("el-col",{attrs:{span:24}},[s("label",{staticStyle:{"font-size":"14px"}},[t._v("数据去向(文件)")])])],1),t._v(" "),s("el-row",[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("接口机："+t._s(t.sink.name))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("存放路径: "+t._s(t.sink.params.path))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("文件命名规则: "+t._s(t.sink.params.fileName))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("协议类型: "+t._s("0"===t.sink.params.protocolType?"ftp":"sftp"))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("ftp/sftp用户名: "+t._s(t.sink.params.ftpSftpUser))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("ftp/sftp密码: "+t._s(t.sink.params.ftpSftpPassword))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("字段分隔符: "+t._s(t.sink.params.fieldSeparatorSign))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("行结束符: "+t._s(t.sink.params.lineEndingSign))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("省分: "+t._s(t._f("provIdTransform")(t.sink.params.provId,t.provinceList)))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("账期: "+t._s("0"===t.sink.params.DataPartition?"日表":"月表"))])])],1)],1):t._e(),t._v(" "),"5"===t.taskForm.type?s("div",[s("el-row",[s("el-col",{attrs:{span:24}},[s("label",{staticStyle:{"font-size":"14px"}},[t._v("数据来源(文件)")])])],1),t._v(" "),s("el-row",[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("接口机："+t._s(t.source.name))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("存放路径: "+t._s(t.source.params.path))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("字段分隔符: "+t._s(t.source.params.fieldSeparatorSign))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("行结束符: "+t._s(t.source.params.lineEndingSign))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("省分: "+t._s(t._f("provIdTransform")(t.source.params.provId,t.provinceList)))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("账期: "+t._s("0"===t.source.params.DataPartition?"日表":"月表"))])])],1),t._v(" "),s("el-row",[s("el-col",{attrs:{span:24}},[s("label",{staticStyle:{"font-size":"14px"}},[t._v("数据来源(表)")])])],1),t._v(" "),s("el-row",[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("数据源类型："+t._s(t.sink.datasourceType))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("集群: "+t._s(t.sink.name))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("库: "+t._s(t.sink.params.db))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("表: "+t._s(t.sink.params.table))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("协议类型: "+t._s("0"===t.source.params.protocolType?"ftp":"sftp"))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("ftp/sftp用户名: "+t._s(t.source.params.ftpSftpUser))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("ftp/sftp密码: "+t._s(t.source.params.ftpSftpPassword))])])],1)],1):t._e()]),t._v(" "),s("el-collapse-item",{attrs:{title:"调度配置",name:"1"}},[s("el-row",[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("开始时间："+t._s(t.taskForm.startTime))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("最长运行时间："+t._s(t.taskForm.maxRunTime)+"(分钟)")])])],1),t._v(" "),s("el-row",[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("重复次数："+t._s(t.taskForm.retry))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("并发数："+t._s(t.taskForm.concurrency))])])],1),t._v(" "),s("el-row",[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("调度周期："+t._s(t.taskForm.cronExpression))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("调度策略："+t._s(t._f("dependencyTypeTransform")(t.taskForm.dependencyType)))])])],1),t._v(" "),s("el-row",[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("允许错误记录数："+t._s(t.taskForm.wrongCount))])]),t._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"dell"},[t._v("上游依赖："+t._s(t.taskForm.parentTtaskName))])])],1)],1)],1)],1)},l=[],r=(s("ac6a"),s("9b5f")),n={name:"任务详情",data:function(){return{taskForm:{cronExpression:"",name:"",type:"0",description:"",maxRunTime:"",concurrency:0,period:"",retry:0,startTime:""},source:{name:"",params:{path:""}},sink:{},taskId:"",provinceList:[]}},methods:{getDetail:function(){var t=this;this.taskId=this.$route.query.id,Object(r["m"])("taskId="+this.taskId).then((function(e){if(200===e.code){t.taskForm=e.data;var s=JSON.parse(e.data.taskXml);t.source=s.context.source,0!==t.taskForm.type&&(t.sink=s.context.sink),console.log(t.source,t.sink)}}))},getProvinceListData:function(){var t=this;Object(r["j"])("pageNum=0&pageSize=40").then((function(e){200===e.code&&(t.provinceList=e.data),console.log(t.provinceList),t.getDetail()}))}},filters:{taskTypeTransform:function(t){return t?"0"===t?"shell":"3"===t?"表到表采集":"4"===t?"表到文件采集":"5"===t?"文件到表采集":void 0:""},dependencyTypeTransform:function(t){return 0===t?"时间和事件依赖":1===t?"时间依赖":2===t?"事件依赖":3===t?"立即执行":void 0},provIdTransform:function(t,e){if(t){var s="未知";return e.forEach((function(e){e.provId===t&&(s=e.provName)})),s}return"未知"}},created:function(){this.getProvinceListData()}},o=n,i=(s("a740"),s("2877")),c=Object(i["a"])(o,a,l,!1,null,null,null);e["default"]=c.exports},"6ddb":function(t,e,s){},"7d2d":function(t,e,s){},"9b5f":function(t,e,s){"use strict";s.d(e,"e",(function(){return l})),s.d(e,"y",(function(){return r})),s.d(e,"w",(function(){return n})),s.d(e,"h",(function(){return o})),s.d(e,"m",(function(){return i})),s.d(e,"l",(function(){return c})),s.d(e,"n",(function(){return p})),s.d(e,"D",(function(){return d})),s.d(e,"f",(function(){return u})),s.d(e,"s",(function(){return m})),s.d(e,"t",(function(){return v})),s.d(e,"u",(function(){return f})),s.d(e,"r",(function(){return _})),s.d(e,"p",(function(){return k})),s.d(e,"j",(function(){return b})),s.d(e,"i",(function(){return h})),s.d(e,"A",(function(){return g})),s.d(e,"k",(function(){return y})),s.d(e,"B",(function(){return w})),s.d(e,"q",(function(){return x})),s.d(e,"o",(function(){return T}));var a=s("b775");s("5c96");function l(t){return Object(a["a"])({url:"/dgp/task/deletetask?"+t,method:"post"})}function r(t){return Object(a["a"])({url:"/dgp/task/onlinetask?"+t,method:"post"})}function n(t){return Object(a["a"])({url:"/dgp/task/offlinetask?"+t,method:"post"})}function o(){return Object(a["a"])({url:"/dgp/task/parentTasklist",method:"get"})}function i(t){return Object(a["a"])({url:"/dgp/task/getTaskById?"+t,method:"post"})}function c(t){return Object(a["a"])({url:"/dgp/task/getTaskListByName?"+t,method:"post"})}function p(t){return Object(a["a"])({url:"/dgp/taskInstance/list?"+t,method:"get"})}function d(t,e){return Object(a["a"])({url:"/dgp/task/getTaskByExample?"+t,method:"post",data:e})}function u(t,e){return Object(a["a"])({url:"/dgp/taskInstance/getTaskInstanceByExample?"+t,method:"post",data:e})}function m(t,e){return Object(a["a"])({url:"/dgp/task/createShellTask?"+t,method:"post",data:e})}function v(t,e){return Object(a["a"])({url:"/dgp/task/newcreateTableToFileTask?"+t,method:"post",data:e})}function f(t,e){return Object(a["a"])({url:"/dgp/task/newcreateTableToTableTask?"+t,method:"post",data:e})}function _(t,e){return Object(a["a"])({url:"/dgp/task/newcreateFileToTaskTask?"+t,method:"post",data:e})}function k(){return Object(a["a"])({url:"/dgp/task/getTaskType",method:"post"})}function b(t){return Object(a["a"])({url:"/dgp/govProvince/list?"+t,method:"get"})}function h(){return Object(a["a"])({url:"/dgp/metadata/getHiveDataSourceList",method:"post"})}function g(t){return Object(a["a"])({url:"/dgp/metadata/selectDatabaseByHive?"+t,method:"post"})}function y(t){return Object(a["a"])({url:"/dgp/metadata/getTableByDatabase?"+t,method:"post"})}function w(){return Object(a["a"])({url:"/dgp/metadata/selectLinuxDataSourceList",method:"post"})}function x(t){return Object(a["a"])({url:"/dgp/datasource/getinterfaceMachineFilePath?"+t,method:"post"})}function T(t){return Object(a["a"])({url:"/dgp/task/getTaskListByUserId?"+t,method:"get"})}},a740:function(t,e,s){"use strict";var a=s("6ddb"),l=s.n(a);l.a}}]);